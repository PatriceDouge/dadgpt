# DadGPT Implementation Progress

## Codebase Patterns
<!-- Reusable patterns discovered during implementation - add here as you learn -->
- Use pnpm (not bun) for all package management
- Use node:fs/promises for file operations (not Bun APIs)
- Use vitest for testing (import from "vitest")
- Use tsx for TypeScript execution
- Storage files go in ~/.dadgpt/data/
- All IDs are ULIDs for sortability
- Use namespace pattern for utility modules (Log, Storage, Bus, etc.)

---

## Progress Log

<!-- Append progress entries below this line -->

## 2026-01-13 - P1-001
- What was implemented: Created package.json with all required dependencies and devDependencies
- Files changed: package.json, pnpm-lock.yaml, .gitignore (new)
- **Learnings for future iterations:**
  - pnpm install works correctly with specified versions
  - Added .gitignore to exclude node_modules/, dist/, coverage/, .env, *.log
---

## 2026-01-13 - P1-002
- What was implemented: Created TypeScript configuration for the project
- Files changed: tsconfig.json (new), src/index.ts (new - minimal entry point)
- **Learnings for future iterations:**
  - moduleResolution "bundler" works well with ES modules and tsx
  - Need at least one .ts file in src/ for typecheck to work (otherwise error about no inputs)
  - noUncheckedIndexedAccess adds extra safety for array/object access
---

## 2026-01-13 - P1-003
- What was implemented: Created Vitest configuration for running tests
- Files changed: vitest.config.ts (new), test/unit/placeholder.test.ts (new)
- **Learnings for future iterations:**
  - vitest.config.ts uses defineConfig from "vitest/config"
  - Test files go in test/ directory with pattern **/*.test.ts
  - Created placeholder test to verify configuration works
  - Coverage reports to text, json, and html formats
---

## 2026-01-13 - P1-004
- What was implemented: Created CLI entry point for dadgpt command
- Files changed: bin/dadgpt (new), src/index.ts (updated)
- **Learnings for future iterations:**
  - bin/dadgpt uses `import("tsx/esm").then(() => import("../src/index.ts"))` pattern for tsx
  - File must be executable (chmod +x) to work as CLI entry
  - pnpm dev runs tsx src/index.ts directly for development
---

## 2026-01-13 - P1-005
- What was implemented: Created ID generation utility using ULID
- Files changed: src/util/id.ts (new), eslint.config.js (new), package.json (eslint deps added)
- **Learnings for future iterations:**
  - ESLint 9 requires flat config file (eslint.config.js) with @eslint/js and typescript-eslint packages
  - ulid package provides ULID generation - IDs are lexicographically sortable by timestamp
  - Utility modules go in src/util/ directory
---

## 2026-01-13 - P1-006
- What was implemented: Created logging utility with configurable log levels
- Files changed: src/util/log.ts (new), eslint.config.js (updated)
- **Learnings for future iterations:**
  - PRD requires namespace pattern for Log utility - disabled @typescript-eslint/no-namespace rule
  - Log levels follow hierarchy: DEBUG > INFO > WARN > ERROR (debug is most verbose)
  - warn() and error() always log regardless of configured level
---

## 2026-01-13 - P1-007
- What was implemented: Created custom error types for better error handling
- Files changed: src/util/errors.ts (new)
- **Learnings for future iterations:**
  - Error classes extend base DadGPTError which extends Error
  - Each error type has a `code` property for programmatic error identification
  - Use Error.captureStackTrace when available to maintain proper stack traces
  - Error types: ConfigError, StorageError, ProviderError, ToolError
---

## 2026-01-13 - P1-008
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Created storage path utilities module
- Files changed: src/storage/paths.ts (new)
- **Learnings for future iterations:**
  - Use node:path and node:os imports (with node: prefix for clarity)
  - DADGPT_DATA_DIR env var allows overriding data directory for testing
  - DADGPT_HOME env var allows overriding home directory
  - Path constants are computed via functions to support env override
  - getDataPath() auto-appends .json extension
  - Storage layer lives in src/storage/ directory
---

## 2026-01-13 - P1-009
Thread: https://ampcode.com/threads/$AMP_CURRENT_THREAD_ID
- What was implemented: Created Storage namespace with CRUD operations for JSON file persistence
- Files changed: src/storage/storage.ts (new)
- **Learnings for future iterations:**
  - Use node:fs/promises (not Bun APIs) for file operations
  - Storage namespace pattern matches other utility modules (Log, Bus, etc.)
  - Storage.read<T>() returns undefined (not null) when file not found
  - Storage.write() uses JSON.stringify with null, 2 for pretty printing
  - Storage.update() provides atomic read-modify-write operation
  - Storage.list() returns filenames without .json extension
  - Must import os from "node:os" at top level - cannot use require() in ESM
---

## 2026-01-13 - P1-010
- What was implemented: Created comprehensive unit tests for the Storage layer
- Files changed: test/unit/storage.test.ts (new)
- **Learnings for future iterations:**
  - Use DADGPT_DATA_DIR env var to override data directory for testing
  - Create unique temp directories per test to avoid conflicts: `${os.tmpdir()}/dadgpt-test-${Date.now()}-${random}`
  - Clean up temp directories in afterEach with fs.rm(dir, { recursive: true, force: true })
  - Tests verify: write/read roundtrip, read non-existent, update creates/modifies, list files, remove, exists, ensureDir
---

## 2026-01-13 - P1-011
- What was implemented: Created Event Bus pub/sub system for decoupled communication
- Files changed: src/bus/bus.ts (new)
- **Learnings for future iterations:**
  - Bus namespace follows same pattern as Log, Storage modules
  - Handler Map stores Set<Handler<unknown>> to support multiple handlers per event
  - publish() wraps each handler call in try/catch so errors don't break other handlers
  - subscribe() returns an unsubscribe function for cleanup
  - Events object provides type-safe event definitions with payload types
  - EventName and EventPayload<E> types exported for type-safe usage
---

## 2026-01-13 - P1-012
- What was implemented: Created comprehensive unit tests for the Event Bus
- Files changed: test/unit/bus.test.ts (new)
- **Learnings for future iterations:**
  - Use vi.spyOn(console, "error").mockImplementation(() => {}) to suppress expected console output in tests
  - Bus.clear() in beforeEach ensures test isolation between tests
  - Test that publish to non-existent event doesn't throw
  - Test that payload reference is preserved (same object, not copied)
---

## 2026-01-13 - P2-001
- What was implemented: Created Zod schemas for configuration validation
- Files changed: src/config/schema.ts (new)
- **Learnings for future iterations:**
  - Config files go in src/config/ directory
  - Zod schemas provide both runtime validation and TypeScript type inference
  - Use z.infer<typeof Schema> to extract types from Zod schemas
  - Default values in schemas using .default() method
  - Export both schemas and inferred types for maximum flexibility
---

## 2026-01-13 - P2-002
- What was implemented: Created default configuration values for DadGPT
- Files changed: src/config/defaults.ts (new)
- **Learnings for future iterations:**
  - Import types with `import type` for type-only imports
  - DEFAULT_CONFIG is typed as Config from schema.ts for type safety
  - Default permissions: allow read-only tools (read, goal, todo, project, family), ask for write/bash
  - goalCategories default to Health, Family, Work, Personal, Finance
---
